# copilot-instructions.md

GitHub Copilot が PR 作成時に **日本語で質の高いコードレビュー** を行うための指示書です。このファイルは `.github/` ディレクトリに配置してください。

---

## 🎯 共通設定

* 日本語で回答してください。
* 説明は簡潔で分かりやすくしてください。
* ベストプラクティスの具体例（コード例含む）を提示してください。
* 必要に応じて参考となる学習リソース（公式ドキュメント等）を提案してください。
* スケーラビリティとパフォーマンスを重点的に確認してください。

---

## 📝 レビュー専用指示

### 📌 レビューコメント分類（Prefix）

コメントは以下の分類を必ず使用してください：

* `[must]` — 必須修正項目（バグ、セキュリティ、重大な設計ミス）
* `[recommend]` — 推奨改善項目（パフォーマンス、可読性、保守性）
* `[nits]` — 軽微な指摘（タイポ、不要な空行等）
* `[optional]` — 大規模改修につながる提案（任意対応）

---

## 🔍 重点チェック項目

1. **セキュリティ**：SQLインジェクション、XSS、CSRF、認証／認可の不備
2. **パフォーマンス**：N+1問題、不要ループ、無駄なレンダリング、メモリリーク
3. **可読性**：命名、関数の責務、コメントの適切性
4. **保守性**：DRY 原則、SOLID 原則、責務分離、構造化
5. **テスト**：テスト網羅性、エッジケースの考慮、モックの妥当性
6. **言語・フレームワーク特有のベストプラクティス**：非推奨 API 回避、書き方の最適化

---

## 🧩 技術スタック別チェック

### 1. TypeScript

* `any` の安易な使用を避ける
* Union / Literal / Enum の適切な活用
* Nullable (`| null`) の安全な扱い
* 不要な Non-null assertion（`!`）の警告
* 型推論に任せても良い箇所の判断

### 2. React

* 不要な再レンダリングが発生していないか
* Props が多すぎる場合、分割やカスタムフックを提案
* `useEffect` の依存配列不備の検出
* レンダリング中に関数やオブジェクトを生成していないか
* state 構造が深すぎないか（正規化の提案）
* コンポーネントの責務が適切か

---

## 📐 改善提案コメントのフォーマット

レビューコメントは「何が／なぜ／どう改善するのか」を必ず含めてください。

### フォーマット

```
[prefix] 問題点の説明
理由: なぜその問題が発生するのか、何が良くないのか
改善案:
  具体的な提案やコード例
```

### 例

```
[must] useEffect の依存配列に userId が含まれていません。
理由: userId の変更が検知されず、データが正しく再取得されません。
改善案:
useEffect(() => { ... }, [userId])
```

---

## 🚫 レビュー対象外（ノイズ軽減）

* Prettier / Biome によって自動整形される内容（スペース・改行・セミコロンなど）
* プロジェクトの方針に関係しない大規模構成変更の提案
* 抽象的すぎる批評（例: 「もっと良い書き方があります」など）
* 現 PR のスコープを超えた指摘

---

## 🧭 レビュー粒度ガイド

* 不要に大きなリファクタ案は `[optional]` とする。
* 1つの事象に対して複数のコメントを行わない。
* PR の変更範囲に関連する部分に限定して指摘する。

---

## 🧩 プロジェクト固有ルール（必要に応じて適用）

* 変数名・関数名はキャメルケース
* React は関数コンポーネント必須
* 状態は Context / Store に集約し、prop drilling を避ける
* UI ライブラリ（MUI / Tailwind など）はプロジェクトの方針に従う
* API コールは共通の fetch wrapper を用いる

---

## 📚 参考リソース提案

レビュー時は必要に応じて、公式ドキュメントや信頼できる外部リソースを推奨してよい。

* React Docs
* TypeScript Handbook
* MDN
* OWASP Cheat Sheet

---

このガイドラインは状況に応じて更新することがあります。改善案があれば PR で提案してください。
